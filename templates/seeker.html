<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Alcove | Seeker</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"/>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet"/>
    <link rel="icon" href="static/img/web_icon.png" />
    <link rel="stylesheet" href="static/styles/main.css" />
    <link rel="stylesheet" href="static/styles/home.css" />
    <link rel="stylesheet" href="static/styles/seeker.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"/>
  </head>

  <body>
    {% include "partial_header.html"%}
    <div class="toast-container">
      {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
              {% for category, message in messages %}
                  <div class="toast toast-top-right" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                      <img src="static/img/web_icon.png" width="32" height="32" class="rounded me-2">
                      <strong class="me-auto">Alcove</strong>
                      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                      {{ message }}
                    </div>
                  </div>
              {% endfor %}
          {% endif %}
      {% endwith %}
    </div>
    <audio controls id="pingAudio" src="static/audio/ping.mp3" style="display:none;"></audio>
    <div class="container">
      <h1 class="h1"><i class="fa-solid fa-comments"></i>&nbsp;Discuss and Debate</h1>
      <hr>         
      <div class="container">
          <div class="row">
            <div class="col-lg-8 col-md-7 col-sm-12">
                <div class="main-body">
                  <div id="chatWindow" class="chat-window container-fluid text-center">
                      <div id="loading" class="spinner-grow text-light" role="status" hidden><span class="fs-5 visually-hidden">Loading...</span></div>
                      <p id="seekerResponse" class="container">
                          {{talk | safe}}
                      </p>
                  </div>
                  <div class="action-bar container">          
                      <div class="search-bar input-group">
                          <form id="chat" action="/chat_seeker" method="POST">
                          <div class="chat-element input-group">
                              <textarea name="message" placeholder="Type a message" class="user-msg" id="userMessage" required></textarea>
                              <button class="p-lg continue" id="sendMessage" type="submit" tabindex="-1"><i class="fa-solid fa-paper-plane"></i></button>
                          </div>    
                          </form>
                      </div>
                      <div class="item-bar">
                          <div><a class="link-icon" href="/seeker" data-bs-toggle="tooltip" data-bs-placement="left" title="Restart chat"><i class="fa-solid fa-arrows-rotate fs-5"></i></a></div>
                          <div><a class="link-icon" data-bs-toggle="modal" data-bs-target="#personalizeModal"><i class="fa-solid fa-wand-sparkles fs-5" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Personalize"></i></a></div>
                          <div><a class="link-icon" data-bs-toggle="modal" data-bs-target="#infoModal" ><i class="fa-solid fa-circle-info fs-5" data-bs-toggle="tooltip" data-bs-placement="right" title="About Seeker"></i></a></div>
                      </div>
                  </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-5 col-sm-12">
                <div class="sidebar">
                    <div class="sidebar-content">
                        <div class="card">
                            <h5 class="card-header"><i class="fa-solid fa-lightbulb"></i>&nbsp;Random Fact - {{fact_topic}}</h5>
                            <div class="card-body">
                              {{fact}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
          </div>
      </div>
    </div>
    <br><br>
    <div class="container">
      <h1 class="h1"><i class="fa-solid fa-book"></i>&nbsp;Briefings</h1>
      <hr>
      <div class="container blog-intro">
        <div class="p-4 p-md-5 mb-4 rounded blog-background">
          <div class="col-lg-6 px-0">
            <h1 class="display-4 fst-italic fc-accent fw-bold">Learn Better</h1>
            <p class="lead my-3">
              Use our <span class="fw-bold">Wikipedia</span> article condensation tool to make the best of what it has to offer.
            </p>
          </div>
        </div>
      </div>
      {% if banned != True: %}
      <div class="my-4">
        <form id="wiki-form" action="/condense_wiki" method="POST" class="d-flex">
          <input type="text" id="wiki-url" class="form-control me-2 fc-dark" placeholder="Enter Wikipedia URL" required>
          <button type="submit" id="submit-btn" class="btn btn-primary">
            <span id="button-text">Submit</span>
            <span class="spinner-border spinner-border-sm d-none" id="spinner" role="status" aria-hidden="true"></span>
          </button>
        </form>
        <div id="message" class="mt-3"></div>
        <div id="modal-container"></div>
        <div id="wiki-table" class="table-responsive" hidden>
          <table class="table">
            <thead>
              <tr>
                <th class="fw-bold" scope="col">Topic</th>
                <th class="fw-bold" scope="col">Actions</th>
              </tr>
            </thead>
            <tbody id="topics-container">
              
            </tbody>
          </table>
        </div>
        </div>
      </div>
      {% endif %}
      {% if banned and warning %}
      <div class="alert alert-danger">
          <p id="user" class="hidden">{{session["nickname"]}}</p>
          <p class="fw-bold fs-4"><i class="fa-solid fa-face-tired"></i>&nbsp;Request Processing Interrupted</p>
          <p>To ensure a smooth and reliable experience for everyone, we've temporarily restricted new requests. This helps us manage the processing load efficiently and prevents interruptions for other users.</p>
          <p>
            <span class="fw-bold">SENTRY:</span>&nbsp;You have <span class="fw-bold">been banned</span> from making another request.  
            Refreshing the page while a request is processing can overload our systems and slow things down for everyone. <span class="fw-bold">Please wait for your current request to finish before submitting another or refreshing the page.</span>
            This behaviour also arouses suspicions of automated activity. </p>
          <p id="countdown" class="fw-bold">  
            Please wait atleast {{duration}} seconds for your ban to be lifted.
          </p>
      </div>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
            const durationElement = document.getElementById('countdown');
            let remainingSeconds = parseInt(durationElement.textContent.match(/\d+/)[0], 10);
        
            function updateCountdown() {
                if (remainingSeconds > 0) {
                    remainingSeconds -= 1;
                    durationElement.textContent = `Please wait atleast ${remainingSeconds} seconds for your ban to be lifted.`;
                } else {
                    window.location.reload();
                }
            }

            setInterval(updateCountdown, 1000);
        });
        </script>
      {% endif %}

    </div>
    
    {% include "personalise_modal.html"%}
    {% include "partial_profile.html"%}
    {% include "partial_menu.html"%}
    {% include "partial_footer.html"%}
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script src="static/scripts/home.js"></script>
    <script src="static/scripts/seeker.js"></script>
  </body>
</html>
